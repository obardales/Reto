# Reto

# Ejercicio Tecnico: Java
Aplicación que expone una API RESTful de creación de usuarios. Este endpoint recibe un usuario con los campos "nombre", "correo", "contraseña",
más un listado de objetos "teléfono", respetando el siguiente formato:

```json
{
  "name": "Oswaldo Bardales",
  "email": "obardales@gmail.com",
  "password": "N1v3l4@ci0n",
  "phones": [
    {
      "number": "999999999",
      "citycode": "1",
      "countrycode": "57"
    }
  ]
}
```

## Solucion
Consideraciones del proyecto

* El proyecto implementa la generacion de token con JWT
* Cualquier otro end-point que se exponga, estará securizado con el JWT generado
* Base de datos basado en HSQL
* Considera LOCALE para cambio de idioma de todos los mensajes (es y en). Configurarlo en el application.properties
* Persistencia con JPA y EclipseLink (se deja en comentario el switch a Hibernate)
* Las validaciones estan realizadas con javax.validation (implementacion de hibernate.validation)


### configurar idioma
En el ```application.properties```, cambiar el valor del "locale".

español:
```properties 
locale = es 
```

ingles:
```properties
locale = en
```


## Iniciar Proyecto
Aplicación basado en Spring boot, para iniciarlo debe ejecutar el task "bootRun" y seguido eso, se podrán realizar las pruebas.
```shell
./gradlew bootRun
```


## Pruebas
A continuación, se detallan los  distintos escenarios y los cURL que deben ejecutarse para generarlos.


### Registro Satisfactorio:
Para realizar un registro satisfactorio, ejecute la siguiente cURL:
```shell
curl --location --request POST 'http://localhost:8080/users' \
--header 'Content-Type: application/json' \
--data-raw '{
    "name": "Oswaldo Bardales",
    "email": "obardales@gmail.com",
    "password": "N1v3l4@ci0n",
    "phones": [
        {
            "number": "999999999",
            "citycode": "1",
            "countrycode": "57"
        }
    ]
}'
```
Obteniendo el siguiente resultado.
```json
{
  "id": "895bedc1-a69d-4f8c-9a57-40bcea76fe6d",
  "created": "2023-02-17T02:14:32.406",
  "modified": "2023-02-17T02:14:32.406",
  "lastLogin": "2023-02-17T02:14:32.406",
  "token": "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJvYmFyZGFsZXNAZ21haWwuY29tIiwiZXhwIjoxNjc2NzA0NDcyLCJpYXQiOjE2NzY2MTgwNzJ9.QAjPXT9Rns5kQUXRhZPkPtPdV522zDjFTY_5nZpl9fF5Od4rfyn2j4J-7nTMFU_N1tw9A_OUPnq1lsOvI5qu8g",
  "active": true
}
```

Reintentar mandando el mismo cURL del registro para obtener el mensaje de error por correo duplicado. Se obtendrá el siguiente resultado.
```json
{
  "message": "Correo (obardales@gmail.com) ya registrado."
}
```



### Formato Clave y Email Incorrecta:
Para la clave, se esta considerando que cumpla con las siguientes condiciones

* Al menos un caracter numerico
* Al menos un caracter en minúscula
* Al menos un caracter en mayúscula
* Al menos un caracter especial: !@#&()–[{}]:;',?/*~$^+=<>
* El tamaño de la clave debe ser >10 y <128

Ejecutar la siguiente cURL
```shell
curl --location --request POST 'http://localhost:8080/users' \
--header 'Content-Type: application/json' \
--data-raw '{{
    "name": "Oswaldo Bardales",
    "email": "obardales@gmail.com",
    "password": "n1v3l4$",
    "phones": [
        {
            "number": "999999999",
            "citycode": "1",
            "countrycode": "57"
        }
    ]
}
'
```
Obteniendo el siguiente mensaje:
```json
{
    "message": "Revisar las siguientes observaciones.",
    "errors": [
        "La clave de tener al menos: un caracter numérico, una minúscula, una mayúscula, un caracter especial ! @ # & ( ), y tener entre 10 a 128 caracteres."
    ]
}
```

## Adicional
El script se encuentra en la carpeta resources/sql/schema.sql.

``` sql
CREATE TABLE IF NOT EXISTS user
(
    id              varchar(36) not null,
    name            varchar(150) not null,
    email           varchar(150) not null UNIQUE,
    password        varchar(256),
PRIMARY KEY(id)
);

CREATE TABLE IF NOT EXISTS user_phone
(
    id              INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1),
    number          varchar(50) not null,
    city_code       smallint not null,
    country_code    smallint not null,
    user_id         varchar(36) not null,
PRIMARY KEY(id)
);


ALTER TABLE user_phone ADD CONSTRAINT FK_user_userphone
  FOREIGN KEY (user_id)
  REFERENCES user(id);
```


## Diagrama
![diagram](diagrama/diagrama-sequencia.png)
